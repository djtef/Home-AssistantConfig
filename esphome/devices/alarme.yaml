substitutions:
  RTTTL_MARIO: >-
        "mario:d=4,o=5,b=100:16e6,16e6,32p,8e6,16c6,8e6,8g6,8p,8g,8p,8c6,16p,8g,16p,8e,16p,8a,8b,16a#,8a,16g.,16e6,16g6,8a6,16f6,8g6,8e6,16c6,16d6,8b,16p,8c6,16p,8g,16p,8e,16p,
        8a,8b,16a#,8a,16g.,16e6,16g6,8a6,16f6,8g6,8e6,16c6,16d6,8b,8p,16g6,16f#6,16f6,16d#6,16p,16e6,16p,16g#,16a,16c6,16p,16a,16c6,16d6,8p,16g6,16f#6,16f6,16d#6,16p,16e6,16p,
        16c7,16p,16c7,16c7,p,16g6,16f#6,16f6,16d#6,16p,16e6,16p,16g#,16a,16c6,16p,16a,16c6,16d6,8p,16d#6,8p,16d6,8p,16c6"
  RTTTL_MISSION: >-
        "MissionImp:d=16,o=6,b=95:32d,32d#,32d,32d#,32d,32d#,32d,32d#,32d,32d,32d#,32e,32f,32f#,32g,g,8p,g,8p,a#,p,c7,p,g,8p,g,8p,f,p,f#,p,g,8p,g,8p,a#,p,c7,p,g,8p,g,8p,f,p,f#,
        p,a#,g,2d,32p,a#,g,2c#,32p,a#,g,2c,a#5,8c,2p,32p,a#5,g5,2f#,32p,a#5,g5,2f,32p,a#5,g5,2e,d#,8d"
  RTTTL_WARNING: >-
        "warning:d=4,o=6,b=150:1a,2b,2b,4c,4c,4c,4c,8d,8d,8d,8d,8d,8d,8d,8d,16e,16e,16e,16e,16e,16e,16e,16e,16e,16e,16e,16e,16e,16e,16e,16e,32f,32f,32f,32f,32f,32f,32f,32f,32f,
        32f,32f,32f,32f,32f,32f,32f,32f,32f,32f,32f,32f,32f,32f,32f,32f,32f,32f,32f,32f,32f,32f"
  RTTTL_HIGH: >-
        "Ring High:d=2,o=6,b=10,b=100:b5,d,b5,d,b5,d,b5,d,d,f,d,f,d,f,d,f,f,a,f,a,f,a,f,a."
  RTTTL_TONES: >-
        "Tones:d=8,o=5,b=500,b=500:b,16p,b,2p,g,16p,g,2p,d6,16p,d6,2p,d,16p,d."
  RTTTL_FAIL: >-   
        "siren:d=8,o=5,b=100:d,e,d,e,d,e,d,e"
  RTTTL_SUCCESS: >-         
        "success:d=32,o=5,b=100:c,c#,d#,e,f#,g#,a#,b"
  RTTTL_SIREN: >-      
        "siren:d=16,o=5,b=100:d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,
        e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,
        e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,
        e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d,e,d"
  alarm_code: !secret alarm_code
  delai_armement: '3'

esphome:
  on_boot:
      then:
        - logger.log:
            format: "Au boot statut_alarme=%s"
            args: [ 'id(statut_alarme).state']
        - lambda: |-
            id(statut_alarme).publish_state("désarmé");
            id(state_alarm_panel).publish_state("disarmed");
          
# if (id(state_int) == ${disarmed_id}) {
# id(alarm_condition).publish_state("disarmed");
# } else if (id(state_int) == ${pending_id}){
# id(alarm_condition).publish_state("armed_home");
# id(state_int) = ${armed_home_id};
# } else if (id(state_int) == ${triggered_id}){
# id(alarm_condition).publish_state("armed_home");
# id(state_int) = ${armed_home_id};
# } else if (id(state_int) == ${armed_home_id}){
# id(alarm_condition).publish_state("armed_home");
# } else{
# id(alarm_condition).publish_state("disarmed");
# id(state_int) = ${disarmed_id};
# }

# Enable Home Assistant API
api:
  services:
    - service: play_rtttl
      variables:
        song_str: string
      then:
        - rtttl.play:
            rtttl: !lambda 'return song_str;'          
    - service: arm_home
      variables:
         code: string
      then:
        - if:
            condition:
              lambda: "return code == \"${alarm_code}\";"
            then:
              - script.execute: alarm_arm
    - service: disarm
      variables:
         code: string
      then:
        - if:
            condition:
              lambda: "return code == \"${alarm_code}\";"
            then:
              - script.execute: alarm_disarm


script:
  - id: attente_armement
    mode: restart 
    then:
      - rtttl.play: ${RTTTL_MARIO}
      - wait_until:
         condition:
           not:
             - rtttl.is_playing
         timeout: ${delai_armement}min
      - rtttl.play: ${RTTTL_HIGH}
      - wait_until:
         condition:
           not:
             - rtttl.is_playing
         timeout: ${delai_armement}min
  - id: attente_desarmement
    mode: restart 
    then:
      - rtttl.play: ${RTTTL_MISSION}
      - wait_until:
         condition:
           not:
             - rtttl.is_playing
      - rtttl.play: ${RTTTL_WARNING}
      - wait_until:
         condition:
           - lambda: |-
               return id(statut_alarme).state != "désarmement";
  - id: commande_clavier
    then:
      - if:
          condition:
            or:
              - lambda: |-
                  return id(statut_alarme).state == "désarmé";
              - lambda: |-
                  return id(statut_alarme).state == "timeout";
          then:
            - script.execute: alarm_arm_delayed
          else:
            - script.execute: alarm_disarm
  - id: trigger_alarm_delayed
    mode: single 
    parameters:
      delay_ms: int
    then:
      - logger.log: "Init déclenchement temporisé..."
      - if:
          condition:
            and:
              - not:
                  script.is_running: trigger_alarm_execute
              - lambda: |-
                  return id(statut_alarme).state == "armé";
          then:
            - lambda: |-
               id(statut_alarme).publish_state("désarmement");
            - script.execute: attente_desarmement
            - delay: !lambda return delay_ms;
            - script.execute: trigger_alarm_execute
  # when arming and disarming, turn off all sirens and buzzers
  # also, cancel any trigger sequence
  - id: alarm_arm
    then:
        - logger.log: "Armé !"
        - script.stop: attente_armement
        - rtttl.stop
        - rtttl.play: ${RTTTL_TONES}
        - lambda: |-
            id(statut_alarme).publish_state("armé");
  - id: alarm_arm_delayed
    then:
        - lambda: |-
              id(statut_alarme).publish_state("armement");
        - logger.log: "Armement..."
        - script.execute: attente_armement
        - wait_until:
            condition:
              or:
                - binary_sensor.is_off: EN_P_FERME
                - binary_sensor.is_off: GA_PORTAIL_FERME
                - not: 
                    script.is_running: attente_armement
        - if:
            condition:
              - binary_sensor.is_off: EN_P_FERME
            then:
              - logger.log: "Porte ouverte"
              - wait_until:
                  condition:
                    or:
                      - binary_sensor.is_on: EN_P_FERME
                      - not: 
                          script.is_running: attente_armement
              - logger.log: "Porte fermée ou délai dépassé"
            else:
              - if:
                  condition:
                    - binary_sensor.is_off: GA_PORTAIL_FERME
                  then:
                    - logger.log: "Portail ouvert"
                    - wait_until:
                        condition:
                          or:
                            - binary_sensor.is_on: GA_PORTAIL_FERME
                            - not: 
                                script.is_running: attente_armement
                    - logger.log: "Portail fermé ou délai dépassé"
                  else:
                    - logger.log: "Dépassement délai ! "
        - if:
            condition:
              - script.is_running: attente_armement
            then:
              - script.execute: alarm_arm
            else:
              - logger.log: "Timeout armement!"  
              - rtttl.stop 
              - rtttl.play: ${RTTTL_FAIL}
              - lambda: |-
                    id(statut_alarme).publish_state("timeout");              
      # - text_sensor.template.publish:
          # id: alarm_condition
          # state: "armed_home"
      # - script.stop: trigger_alarm_execute
      # - switch.turn_off: buzzer_front_door
      # - lambda: |-
          # id(state_int) = ${armed_home_id};
  - id: alarm_disarm
    then:
        - logger.log: "Désarmement..."
        - script.stop: alarm_arm_delayed
        - script.stop: attente_armement
        - script.stop: trigger_alarm
        - script.stop: attente_desarmement
        - script.stop: trigger_alarm_delayed
        - script.stop: trigger_alarm_execute
        - lambda: |-
              id(statut_alarme).publish_state("désarmé");
        - rtttl.play: ${RTTTL_SUCCESS}
      # - text_sensor.template.publish:
          # id: alarm_condition
          # state: "disarmed"
      # - script.stop: trigger_alarm_execute
      # - switch.turn_off: buzzer_front_door
      # - lambda: |-
          # id(state_int) = ${disarmed_id};
  # triggering sequence
  - id: trigger_alarm_execute
    then:
        - logger.log: "Déclenchement..."
        - lambda: |-
            id(statut_alarme).publish_state("déclenché");
        - rtttl.play: ${RTTTL_SIREN}
      # - text_sensor.template.publish:
          # id: alarm_condition
          # state: "pending"
      # - switch.turn_on: buzzer_front_door
      # - lambda: |-
          # id(state_int) = ${pending_id};
      # - delay: 30s
      # - text_sensor.template.publish:
          # id: alarm_condition
          # state: "triggered"
      # - switch.turn_off: buzzer_front_door
      # - lambda: |-
          # id(state_int) = ${triggered_id};
      # - delay: 3600s
      # TODO: turn on siren

  # only execute triggering if armed and not already running
  - id: trigger_alarm
    then:
      - logger.log: "Init déclenchement..."
      - if:
          condition:
            and:
              - not:
                  script.is_running: trigger_alarm_execute
              - lambda: |-
                    return id(statut_alarme).state == "armé";
          then:
            - script.execute: trigger_alarm_execute

number:
  - platform: template
    name: "Code"
    min_value: 0
    max_value: 9999
    step: 1
    mode: "box"
    set_action :
      then:
        - if:
            condition:
              lambda: "return x == ${alarm_code};"
            then:
              - if:
                  condition:
                    or:
                      - lambda: |-
                          return id(statut_alarme).state == "désarmé";
                      - lambda: |-
                          return id(statut_alarme).state == "timeout";
                  then:
                    - script.execute: alarm_arm_delayed
                  else:
                    - script.execute: alarm_disarm

# holds alarm condition for arm/disarm/pending/triggered
text_sensor:
  - platform: template
    name: "Statut alarme"
    id: "statut_alarme"
    on_value:
      then:
        - lambda: |-
            if (x == "armé")
            {
             id(state_alarm_panel).publish_state("armed_away");
            }
            else if ((x == "désarmé") || (x == "timeout") )
            {
             id(state_alarm_panel).publish_state("disarmed");
            }
            else if (x == "armement")
            {
             id(state_alarm_panel).publish_state("arming");
            }
            else if (x == "désarmement")
            {
             id(state_alarm_panel).publish_state("pending");
            }
            else if (x == "déclenché")
            {
             id(state_alarm_panel).publish_state("triggered");
            }
            else
            {
             id(state_alarm_panel).publish_state("unavailable ");
            }
  - platform: template
    name: "State Alarm Panel"
    id: "state_alarm_panel"

mcp23017:
  - id: 'mcp23017_hub_b1'
    i2c_id: bus_b
    address: 0x20
  - id: 'mcp23017_hub_b2'
    i2c_id: bus_b
    address: 0x21
  - id: 'mcp23017_hub_b3'
    i2c_id: bus_b
    address: 0x22
  - id: 'mcp23017_hub_b4'
    i2c_id: bus_b
    address: 0x23
  - id: 'mcp23017_hub_b5'
    i2c_id: bus_b
    address: 0x24

# Individual inputs
binary_sensor:
  # - platform: gpio #GPIO35
    # name: "GPIO35"
    # id: gpio35
    # pin: 35
  # - platform: gpio #GPIO36
    # name: "Autoprotection capteur présence Bureau"
    # id: BU_AP_PIR
    # pin: 36
  # - platform: gpio #GPIO39
    # name: "Alarme clavier Entrée"
    # id: EN_ALARM_CLAVIER
    # pin: 39
  - platform: gpio #in01
    name: "Porte Entrée verrouillée"
    id: EN_P_VERR
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b1
      number: 8
      mode: INPUT_PULLUP
      inverted: True
    on_release :
      then:
        - logger.log: "Porte déverrouillée"
        - if:
            condition:
              - binary_sensor.is_off: EN_P_FERME
            then:
              - logger.log: "Déclenchement tempo déverrouillage"
              - script.execute: 
                  id: trigger_alarm_delayed
                  delay_ms: 20000
  - platform: gpio #in02
    name: "Porte Entrée fermée"
    id: EN_P_FERME
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b1
      number: 9
      mode: INPUT_PULLUP
      inverted: True
    on_release :
      then:
        - logger.log: "Porte ouverte"
        - if:
            condition:
              - binary_sensor.is_off: EN_P_VERR
            then:
              - logger.log: "Déclenchement tempo ouverture"
              - script.execute: 
                  id: trigger_alarm_delayed
                  delay_ms: 30000
  - platform: gpio #in03
    name: "Porte Garage verrouillée Droite"
    id: GA_P_VERR_D
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b1
      number: 10
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in04
    name: "Porte Garage verrouillée Gauche"
    id: GA_P_VERR_G
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b1
      number: 11
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in05
    name: "Porte Garage fermée Gauche"
    id: GA_P_FERME_G
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b1
      number: 12
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in06
    name: "Fenêtre Garage fermée"
    id: GA_F_FERME
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b1
      number: 13
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in07
    name: "Portail Garage fermé"
    id: GA_PORTAIL_FERME
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b1
      number: 14
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in08
    name: "Fenêtre Palier verrouillée Gauche"
    id: PA_F_VERR_G
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b1
      number: 15
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in09
    name: "VR Palier fermés"
    id: PA_VR_FERME
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b1
      number: 7
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in10
    name: "Fenêtre Palier fermée Gauche"
    id: PA_F_FERME_G
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b1
      number: 6
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in11
    name: "Fenêtre Palier verrouillée Droite"
    id: PA_F_VERR_D
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b1
      number: 5
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in12
    name: "Fenêtre Palier fermée Droite"
    id: PA_F_FERME_D
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b1
      number: 4
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in13
    name: "Fenêtre Bureau verrouillée Gauche"
    id: BU_F_VERR_G
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b1
      number: 3
      mode: INPUT_PULLUP
      inverted: True
    on_release :
      then:
        - if:
            condition:
              - binary_sensor.is_off: BU_F_FERME_G
            then:
              - logger.log: "Fenêtre Bureau déverrouillée Gauche"
              - script.execute: trigger_alarm
  - platform: gpio #in14
    name: "VR Bureau fermés"
    id: BU_VR_FERME
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b1
      number: 2
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in15
    name: "Fenêtre Bureau fermée Gauche"
    id: BU_F_FERME_G
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b1
      number: 1
      mode: INPUT_PULLUP
      inverted: True
    on_release :
      then:
        - if:
            condition:
              - binary_sensor.is_off: BU_F_VERR_G
            then:
              - logger.log: "Fenêtre Bureau ouverte Gauche"
              - script.execute: trigger_alarm
  - platform: gpio #in16
    name: "Fenêtre Bureau verrouillée Droite"
    id: BU_F_VERR_D
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b1
      number: 0
      mode: INPUT_PULLUP
      inverted: True    
    on_release :
      then:
        - if:
            condition:
              - binary_sensor.is_off: BU_F_FERME_D
            then:
              - logger.log: "Fenêtre Bureau déverrouillée Droite"
              - script.execute: trigger_alarm
  - platform: gpio #in17
    name: "Fenêtre Bureau fermée Droite"
    id: BU_F_FERME_D
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b3
      number: 8
      mode: INPUT_PULLUP
      inverted: True
    on_release :
      then:
        - if:
            condition:
              - binary_sensor.is_off: BU_F_VERR_D
            then:
              - logger.log: "Fenêtre Bureau ouverte Droite"
              - script.execute: trigger_alarm
  - platform: gpio #in18
    name: "VR Porte-fenêtre Salon fermés"
    id: SA_VR_PF_FERME
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b3
      number: 9
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in19
    name: "Porte-fenêtre Salon verrouillée"
    id: SA_PF_VERR
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b3
      number: 10
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in20
    name: "Porte-fenêtre Salon fermée"
    id: SA_PF_FERME
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b3
      number: 11
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in21
    name: "Fenêtre Chambre 1 verrouillée Gauche"
    id: C1_F_VERR_G
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b3
      number: 12
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in22
    name: "VR Chambre 1 fermés"
    id: C1_VR_FERME
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b3
      number: 13
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in23
    name: "Fenêtre Chambre 1 fermée Gauche"
    id: C1_F_FERME_G
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b3
      number: 14
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in24
    name: "Fenêtre Chambre 1 verrouillée Droite"
    id: C1_F_VERR_D
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b3
      number: 15
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in25
    name: "Fenêtre Chambre 1 fermée Droite"
    id: C1_F_FERME_D
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b3
      number: 7
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in26
    name: "Baie Salon verrouillée Gauche"
    id: SA_B_VERR_G
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b3
      number: 6
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in27
    name: "VR Baie Salon fermés Gauche"
    id: SA_VR_B_FERME_G
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b3
      number: 5
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in28
    name: "Baie Salon Fermée Gauche"
    id: SA_B_FERME_G
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b3
      number: 4
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in29
    name: "Baie Salon verrouillée Droite"
    id: SA_B_VERR_D
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b3
      number: 3
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in30
    name: "VR Baie Salon fermés Droite"
    id: SA_VR_B_FERME_D
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b3
      number: 2
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in31
    name: "Baie Salon fermée Droite"
    id: SA_B_FERME_D
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b3
      number: 1
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in32
    name: "Fenêtre SDB RDC fermée"
    id: BB_F_FERME
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b3
      number: 0
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in33
    name: "Fenêtre SDB RDC verrouillée"
    id: BB_F_VERR
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b5
      number: 8
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in34
    name: "Baie Cuisine verrouillée Gauche"
    id: CU_B_VERR_G
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b5
      number: 9
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in35
    name: "VR Cuisine fermés Gauche"
    id: CU_VR_FERME_G
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b5
      number: 10
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in36
    name: "Baie Cuisine fermée Gauche"
    id: CU_B_FERME_G
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b5
      number: 11
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in37
    name: "Baie Cuisine verrouillée Droite"
    id: CU_B_VERR_D
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b5
      number: 12
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in38
    name: "VR Cuisine fermés Droite"
    id: CU_VR_FERME_D
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b5
      number: 13
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in39
    name: "Baie Cuisine fermée Droite"
    id: CU_B_FERME_D
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b5
      number: 14
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in40
    name: "Fenêtre SDJ verrouillée Gauche"
    id: SJ_F_VERR_G
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b5
      number: 15
      mode: INPUT_PULLUP
      inverted: True      
  #--------------BAS-------------------    
  - platform: gpio #in41
    name: "VR SDJ fermés"
    id: SJ_VR_FERME
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b2
      number: 8
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in42
    name: "Fenêtre SDJ fermée Gauche"
    id: SJ_F_FERME_G
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b2
      number: 9
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in43
    name: "Fenêtre SDJ verrouillée Droite"
    id: SJ_F_VERR_D
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b2
      number: 10
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in44
    name: "Fenêtre SDJ fermée Droite"
    id: SJ_F_FERME_D
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b2
      number: 11
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in45
    name: "Fenêtre Chambre 3 verrouillée Gauche"
    id: C3_F_VERR_G
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b2
      number: 12
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in46
    name: "Fenêtre Chambre 3 fermée Gauche"
    id: C3_F_FERME_G
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b2
      number: 13
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in47
    name: "Fenêtre Chambre 3 verrouillée Droite"
    id: C3_F_VERR_D
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b2
      number: 14
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in48
    name: "VR Chambre 3 fermés"
    id: C3_VR_FERME
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b2
      number: 15
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in49
    name: "Fenêtre Chambre 3 fermée Droite"
    id: C3_F_FERME_D
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b2
      number: 7
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in50
    name: "Fenêtre Chambre 2 verrouillée Gauche"
    id: C2_F_VERR_G
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b2
      number: 6
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in51
    name: "Fenêtre Chambre 2 fermée Gauche"
    id: C2_F_FERME_G
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b2
      number: 5
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in52
    name: "Fenêtre Chambre 2 verrouillée Droite"
    id: C2_F_VERR_D
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b2
      number: 4
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in53
    name: "VR Chambre 2 fermés"
    id: C2_VR_FERME
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b2
      number: 3
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in54
    name: "Fenêtre Chambre 2 fermée Droite"
    id: C2_F_FERME_D
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b2
      number: 2
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in55
    name: "Fenêtre WC Etage fermée"
    id: WH_F_FERME
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b2
      number: 1
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in56
    name: "Fenêtre WC Etage verrouillée"
    id: WH_F_VERR
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b2
      number: 0
      mode: INPUT_PULLUP
      inverted: True      
  - platform: gpio #in57
    name: "VR Escalier fermés"
    id: PA_VR_ESC_FERME
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b4
      number: 8
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in58
    name: "Fenêtre Escalier fermée"
    id: PA_F_ESC_FERME
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b4
      number: 9
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in59
    name: "Fenêtre Escalier verrouillée"
    id: PA_F_ESC_VERR
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b4
      number: 10
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in60
    name: "Fenêtre WC RDC fermée"
    id: WB_F_FERME
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b4
      number: 11
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in61
    name: "Fenêtre WC RDC verrouillée"
    id: WB_F_VERR
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b4
      number: 12
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in62
    name: "Fenêtre SDB Etage fermée"
    id: BH_F_FERME
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b4
      number: 13
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in63
    name: "Fenêtre SDB Etage verrouillée"
    id: BH_F_VERR
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b4
      number: 14
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in64
    name: "VR Cellier fermés"
    id: CE_VR_FERME
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b4
      number: 15
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in65
    name: "Fenêtre Cellier verrouillée"
    id: CE_F_VERR
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b4
      number: 7
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in66
    name: "Fenêtre Cellier fermée"
    id: CE_F_FERME
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b4
      number: 6
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in67
    name: "Autoprotection sirène intérieure"
    id: AP_SIR_INT
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b4
      number: 5
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in68
    name: "Activation clavier entrée"
    id: EN_ACT_CLAVIER
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b4
      number: 4
      mode: INPUT_PULLUP
      inverted: True
    on_press:
      then:
        - script.execute: commande_clavier
  - platform: gpio #in69
    name: "Capteur présence bureau"
    id: BU_PIR
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b4
      number: 3
      mode: INPUT_PULLUP
      inverted: False
  - platform: gpio #in70
    name: "in70"
    id: in70
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b4
      number: 2
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in71
    name: "in71"
    id: in71
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b4
      number: 1
      mode: INPUT_PULLUP
      inverted: True
    # on_release :
      # then:
        # - if:
            # condition:
              # - binary_sensor.is_off: <GARDE_FOU>
            # then:
              # - logger.log: "<enter log>"
              # - script.execute: trigger_alarm
  - platform: gpio #in72
    name: "in72"
    id: in72
    filters:
      - delayed_on: 50ms
      - delayed_off: 50ms
    pin:
      mcp23xxx: mcp23017_hub_b4
      number: 0
      mode: INPUT_PULLUP
      inverted: True   

# Individual outputs
switch:
  - platform: gpio
    id: out73
    name: "out73"
    pin:
      mcp23xxx: mcp23017_hub_b5
      number: 0
      mode: OUTPUT
      inverted: False
  - platform: gpio
    id: out74
    name: "out74"
    pin:
      mcp23xxx: mcp23017_hub_b5
      number: 1
      mode: OUTPUT
      inverted: False
  - platform: gpio
    id: out75
    name: "out75"
    pin:
      mcp23xxx: mcp23017_hub_b5
      number: 2
      mode: OUTPUT
      inverted: False
  - platform: gpio
    id: out76
    name: "out76"
    pin:
      mcp23xxx: mcp23017_hub_b5
      number: 3
      mode: OUTPUT
      inverted: False
  - platform: gpio
    id: out77
    name: "out77"
    pin:
      mcp23xxx: mcp23017_hub_b5
      number: 4
      mode: OUTPUT
      inverted: False
  - platform: gpio
    id: out78
    name: "out78"
    pin:
      mcp23xxx: mcp23017_hub_b5
      number: 5
      mode: OUTPUT
      inverted: False
  - platform: gpio
    id: out79
    name: "out79"
    pin:
      mcp23xxx: mcp23017_hub_b5
      number: 6
      mode: OUTPUT
      inverted: False
  - platform: gpio
    id: SA_SIRENE
    name: "Sirène salon"
    pin:
      mcp23xxx: mcp23017_hub_b5
      number: 7
      mode: OUTPUT
      inverted: False
    restore_mode:  ALWAYS_OFF
    
output:
  - platform: ledc
    pin: GPIO12
    id: rtttl_out
    
rtttl:
  output: rtttl_out
  on_finished_playback:
    - logger.log: 'Song ended!'
    